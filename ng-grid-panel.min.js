/**
 * @license ngGridPanel
 * (c) 2014 Hacklone https://github.com/Hacklone
 * License: MIT
 */
angular.module("ngGridPanel",["ngAnimate"]).directive("gridPanel",["$animate","$compile","$window","$document","$timeout",function(e,n,t,r,i){return{restrict:"AE",scope:{onPanelOpened:"&",onPanelClosed:"&",onPanelUpdate:"&"},compile:function(o,a){function l(){var e=o.find("grid-panel-item, .grid-panel-item").clone();if(!e.length)throw new Error("grid-panel-item template must be set");return e}function c(){var e=o.find("grid-panel-content, .grid-panel-content").clone();if(!e.length)throw new Error("grid-panel-content template must be set");return e.prepend(angular.element('<div class="close-x">')).prepend(angular.element('<div class="triangle">')),e}var u=angular.element(t),d=angular.element(r).find("html, body"),f=l(),s=c();if(!a.repeat)throw new Error("repeat attribute must be set");var p=a.repeat.match(/\s?(.*)\sin\s(.*)\s?/);if(!p||p.length<3)throw new Error('repeat attribute must be set like repeat="item in items"');var m,g,v,h=p[1],w=p[2];return{pre:function(t,r){function o(){t.$parent.$watchCollection(w,a)}function a(i){r.empty();for(var o=0,a=i.length;a>o;o++){var c=t.$new(),u=i[o];c[h]=u;var d=f.clone();d.addClass("grid-panel-item-"+o).on("click",function(e,n){return function(){l(e,n)}}(o,u)),e.enter(d,r),n(d)(c)}}function l(o,a){function l(e){for(var n=e,t=e.next();t.length&&n.offset().top===t.offset().top;)n=t,t=n.next();return n}function c(){g=E;p(),v=t.$new(!0,t.$parent),m=s.clone(),m.find(".close-x").on("click",function(e){return function(){p(),t.onPanelClosed({item:e})}}(a)),e.enter(m,null,b),n(m)(v),f(),t.onPanelOpened({item:a})}function f(){v[h]=a,v.$digest(),t.onPanelUpdate({item:a})}function p(){m&&(e.leave(m),m=void 0),v&&(v.$destroy(),v=void 0),t.$digest()}function w(){function e(){var e=m.offset().top,n=u.scrollTop()+u.height()/2;e>n&&d.animate({scrollTop:e-2*P.outerHeight(!0)},500)}m&&i(e,350)}function $(){m&&m.find(".triangle").css({left:P.position().left+P.width()/2})}var P=r.find(".grid-panel-item-"+o),b=l(P),E=b.attr("class");m&&g===E?f():c(),$(),w()}o()}}}}}]);